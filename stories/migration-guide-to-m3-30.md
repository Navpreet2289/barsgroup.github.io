<!-- 
.. title: Инструкция по переходу на M3 3.0
.. slug: migration-guide-to-m3-30
.. date: 2014/08/18 15:56:36
.. tags: 
.. link: 
.. description: 
.. type: text
-->

## Содержание

1. Ключевые отличия
2. Перевод проекта
    - Что нужно сделать вначале?
    - Перевод экшенов
        - Стандартные экшены и паки
        - Обновленный Context Declaration
        - Перевод справочников на objectpack
        - Зависимые Master/Detail компоненты
    - UI
        - Плагины
    - Templates (template-globals)
    - Работа со статикой


## Ключевые отличия

- Браузер взаимодействует с сервером исключительно через json;
- Отказ от django templates (template-globals) в пользу static js-файлов;
- Если в m3 2.0 для получения формы с данными используется один ajax-запрос на сервер.
То в версии 3.0 будет последовательно генерироваться три запроса:

    - Запрос за данными;
    - Запрос за ui (json-конфигурация);
    - Запрос за статической js-частью (js-логика).

- UI формируется по прежнему на сервере через python;
- Полная поддержка классов Action, ActionPack;
- "Справочниковые" экшены поддерживаются только
[ObjectPack-ом](http://objectpack.docs.bars-open.ru/).
Поэтому классы наследоваемые от паков или экшенов
необходимо перевести на objectpack:

    - m3.actions.dics.*
    - m3.actions.packs.*

## Перевод проекта

### Что нужно сделать вначале?

Подготовка к запуску проекта на новой версии:

- Необходимо сделать минимальное рабочее приложение на текущей ветке (dev), которое бы
запускалось и могло бы отображать рабочий стол;
- Необходимо установить два виртуальных окружения: одно (*старое*) для рабочей версии
(будет являться примером), второе (*новое*) для версии, где будут происходить исправления;
- В рабочей версии нужно временно закоментировать максимальное количество приложений (модулей), без которых
система сможет запускаться, то же самое проделать на версии с обновленной платформой;
- В корне проекта нужно создать файл TRASH.py, где будут находиться заглушки удаленных компонентов.
Пример файла для проекта Род. плата можно посмотреть
[здесь](https://gist.github.com/prefer/de542c929413195f466c);
- Необходимо произвести переименование устаревших импортов на импорты из модуля TRASH.py
- Любые изменения, комментирования исходников сопровождаются тегом #NR,
для удобного последующего поиска;
- Затем в несколько этапов нужно включать приложения в INSTALLED_APPS
добавляя в TRASH.py новые классы-заглушки:

    - Сначала зависимые модули;
    - Затем оставшиеся приложения;
    - И наконец плагины и сопутствующий функционал.

- По мере включения что-то может ломаться, в таком случае необходимо дополнять файл TRASH.py
новыми классами-заглушками и делать импорты на этот файл;
- В итоге получили рабочий стол с настроенным меню “Пуск” и верхним topbar-ом.
Все окна остаются не рабочими.



### Стандартные экшены и паки

